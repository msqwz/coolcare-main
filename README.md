# CoolCare PWA

Progressive Web App –¥–ª—è –º–∞—Å—Ç–µ—Ä–æ–≤ –ø–æ —Ä–µ–º–æ–Ω—Ç—É –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—é –∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä–æ–≤.

## üì± –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –î–ª—è –º–∞—Å—Ç–µ—Ä–æ–≤ (PWA)
- **PWA** ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω, —Ä–∞–±–æ—Ç–∞ –≤ –æ—Ñ—Ñ–ª–∞–π–Ω–µ (Service Worker + IndexedDB)
- **SMS-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** ‚Äî –≤—Ö–æ–¥ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–∫–æ–¥ –≤ debug_mode)
- **–ó–∞—è–≤–∫–∏** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ, —Å—Ç–∞—Ç—É—Å—ã
  - üìÖ –ù–∞–∑–Ω–∞—á–µ–Ω–∞
  - üîß –í —Ä–∞–±–æ—Ç–µ
  - ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∞
  - ‚ùå –û—Ç–º–µ–Ω–µ–Ω–∞
- **–û—Ñ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º** ‚Äî –∑–∞—è–≤–∫–∏ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π
- **–ö–∞–ª–µ–Ω–¥–∞—Ä—å** ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—è–≤–æ–∫ –ø–æ –¥–Ω—è–º –∏ –Ω–µ–¥–µ–ª—è–º —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π –≤—ã—Ö–æ–¥–Ω—ã—Ö/—Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π
- **–ö–∞—Ä—Ç–∞** ‚Äî Yandex Maps —Å –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∑–∞—è–≤–æ–∫
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–∞** ‚Äî –∞–ª–≥–æ—Ä–∏—Ç–º nearest-neighbour –¥–ª—è –ø–æ—Ä—è–¥–∫–∞ –≤–∏–∑–∏—Ç–æ–≤
- **–î–∞—à–±–æ—Ä–¥** ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞—è–≤–æ–∫ –∏ –≤—ã—Ä—É—á–∫–∏

### –î–ª—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–æ–≤ (Admin CRM)
- üìä **–î–∞—à–±–æ—Ä–¥** ‚Äî –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–∏—Å—Ç–µ–º–µ
- üë• **–ú–∞—Å—Ç–µ—Ä–∞** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, —Ä–æ–ª–∏, –∞–∫—Ç–∏–≤–∞—Ü–∏—è
- üìã **–ó–∞—è–≤–∫–∏** ‚Äî –≤—Å–µ –∑–∞—è–≤–∫–∏ –≤—Å–µ—Ö –º–∞—Å—Ç–µ—Ä–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
- ‚öôÔ∏è **–£—Å–ª—É–≥–∏** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ —É—Å–ª—É–≥–∞–º–∏
- üó∫Ô∏è **–ö–∞—Ä—Ç–∞** ‚Äî –≤—Å–µ –∑–∞—è–≤–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
coolcare-main/
‚îú‚îÄ‚îÄ backend/              # FastAPI —Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ main.py          # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ API
‚îÇ   ‚îú‚îÄ‚îÄ auth.py          # JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ database.py      # Supabase –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ schemas.py       # Pydantic —Å—Ö–µ–º—ã
‚îÇ   ‚îî‚îÄ‚îÄ push_service.py  # Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚îú‚îÄ‚îÄ frontend/            # PWA –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (React)
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/  # React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ context/     # Context API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ styles/      # CSS —Å—Ç–∏–ª–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ lib/         # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ public/          # –°—Ç–∞—Ç–∏–∫–∞ (icons, manifest)
‚îú‚îÄ‚îÄ dispatcher/          # –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å (React)
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/       # –°—Ç—Ä–∞–Ω–∏—Ü—ã CRM
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/  # UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ context/     # Admin context
‚îÇ   ‚îî‚îÄ‚îÄ public/          # –°—Ç–∞—Ç–∏–∫–∞
‚îú‚îÄ‚îÄ shared/              # –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ nginx/               # Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ .github/             # GitHub Actions (–∞–≤—Ç–æ-–¥–µ–ø–ª–æ–π)
‚îú‚îÄ‚îÄ app.py               # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ deploy.sh            # –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è –Ω–∞ VPS
‚îî‚îÄ‚îÄ README.md            # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ |
| --------- | ---------- |
| **Frontend PWA** | React 18, Vite 5, React Router, IndexedDB |
| **Admin CRM** | React 19, Vite 7, React Router, Lucide Icons |
| **Backend** | FastAPI, Uvicorn, Pydantic |
| **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** | Supabase (PostgreSQL) |
| **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** | JWT, SMS –∫–æ–¥—ã |
| **–ö–∞—Ä—Ç—ã** | Yandex Maps API |
| **Push** | Web Push API |
| **–î–µ–ø–ª–æ–π** | GitHub Actions, Nginx |

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repository-url>
cd coolcare-main

# Backend
cd backend
python -m venv venv
venv\Scripts\activate        # Windows
source venv/bin/activate     # Linux/Mac
pip install -r requirements.txt
cp .env.example .env         # –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
python main.py               # –∑–∞–ø—É—Å–∫ –Ω–∞ –ø–æ—Ä—Ç—É 8000

# Frontend PWA (–≤ –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
cd frontend
npm install
npm run dev                  # –∑–∞–ø—É—Å–∫ –Ω–∞ –ø–æ—Ä—Ç—É 5173

# Admin CRM (–≤ –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
cd dispatcher
npm install
npm run dev                  # –∑–∞–ø—É—Å–∫ –Ω–∞ –ø–æ—Ä—Ç—É 5174
```

### 2. –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤–º–µ—Å—Ç–µ)

```bash
# –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
npm run server              # Backend –Ω–∞ –ø–æ—Ä—Ç—É 8000
# –í –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
npm run dev:frontend        # PWA –Ω–∞ –ø–æ—Ä—Ç—É 5173
# –í –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
npm run dev:dispatcher      # Admin –Ω–∞ –ø–æ—Ä—Ç—É 5174
```

### 3. –ü—Ä–æ–¥–∞–∫—à–µ–Ω —Å–±–æ—Ä–∫–∞

```bash
# –°–æ–±—Ä–∞—Ç—å frontend –∏ dispatcher
npm run build

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä (—Ä–∞–∑–¥–∞—ë—Ç —Å—Ç–∞—Ç–∏–∫—É –∏–∑ dist/)
cd backend && python main.py
```

**–î–æ—Å—Ç—É–ø:**
- PWA –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: `http://localhost:8000/`
- Admin CRM: `http://localhost:8000/admin`

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### Backend (`backend/.env`)

```env
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your-anon-key
SUPABASE_SERVICE_KEY=your-service-role-key
JWT_SECRET=your-secret-key-change-in-production
```

### Frontend PWA (`frontend/.env`)

```env
VITE_API_URL=http://localhost:8000
VITE_YANDEX_MAPS_API_KEY=your-yandex-maps-key
```

### Admin CRM (`dispatcher/.env`)

```env
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key
VITE_YANDEX_MAPS_API_KEY=your-yandex-maps-key
```

## üì¶ –î–µ–ø–ª–æ–π –Ω–∞ VPS (Ubuntu)

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π (—Å–∫—Ä–∏–ø—Ç)

```bash
# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ deploy.sh
bash deploy.sh
```

**–°–∫—Ä–∏–ø—Ç —Å–¥–µ–ª–∞–µ—Ç:**
1. –°–±–æ—Ä–∫—É frontend –∏ dispatcher
2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ backend –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
3. –ù–∞—Å—Ç—Ä–æ–π–∫—É Nginx –∫–∞–∫ reverse proxy

**–î–æ—Å—Ç—É–ø –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:**
- –ú–∞—Å—Ç–µ—Ä PWA: `http://–≤–∞—à-ip/`
- –ê–¥–º–∏–Ω CRM: `http://–≤–∞—à-ip/admin`

### –ê–≤—Ç–æ-–¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub Actions

–î–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π GitHub:

| –°–µ–∫—Ä–µ—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
| ------ | -------- |
| `VPS_HOST` | IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ |
| `VPS_USER` | SSH –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä `root`) |
| `VPS_SSH_KEY` | –ü—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á |

**Workflow:** –ü—Ä–∏ –ø—É—à–µ –≤ –≤–µ—Ç–∫—É `main` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç –Ω–∞ VPS.

## üìä API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `POST /auth/send-code` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ SMS –∫–æ–¥–∞
- `POST /auth/verify-code` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞, –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- `GET /auth/me` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- `PUT /auth/me` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è

### –ó–∞—è–≤–∫–∏
- `GET /jobs` ‚Äî —Å–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /jobs/{id}` ‚Äî –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `POST /jobs` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏
- `PUT /jobs/{id}` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏
- `DELETE /jobs/{id}` ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏

### –î–∞—à–±–æ—Ä–¥
- `GET /dashboard/stats` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
- `GET /admin/jobs` ‚Äî –≤—Å–µ –∑–∞—è–≤–∫–∏
- `GET /admin/users` ‚Äî –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `PUT /admin/users/{id}` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /admin/services` ‚Äî —Å–ø–∏—Å–æ–∫ —É—Å–ª—É–≥
- `POST /admin/services` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —É—Å–ª—É–≥–∏

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase

### 1. –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –Ω–∞ [supabase.com](https://supabase.com)

### 2. –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL —Å—Ö–µ–º—É

–§–∞–π–ª: `backend/supabase_schema.sql`

```sql
-- –¢–∞–±–ª–∏—Ü—ã: users, jobs, predefined_services, sms_codes, push_subscriptions
-- –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤ Supabase Dashboard ‚Üí SQL Editor
```

### 3. –ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á–∏

- `SUPABASE_URL` ‚Äî URL –ø—Ä–æ–µ–∫—Ç–∞
- `SUPABASE_KEY` ‚Äî anon key (–∏–∑ Settings ‚Üí API)
- `SUPABASE_SERVICE_KEY` ‚Äî service_role key (–∏–∑ Settings ‚Üí API)

## üìà –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

- [ ] **–ß–∞—Ç —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏** ‚Äî WebSocket –∏–ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –∑–∞—è–≤–∫–µ
- [ ] **–§–æ—Ç–æ–æ—Ç—á—ë—Ç—ã** ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ "–¥–æ" –∏ "–ø–æ—Å–ª–µ" (Supabase Storage)
- [ ] **Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** ‚Äî –±–æ—Ç –¥–ª—è –æ–ø–æ–≤–µ—â–µ–Ω–∏—è –º–∞—Å—Ç–µ—Ä–æ–≤
- [ ] **–≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á—ë—Ç–æ–≤** ‚Äî PDF/Excel –ø–æ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–º –∑–∞—è–≤–∫–∞–º
- [ ] **–ß–µ–∫-–ª–∏—Å—Ç—ã —Ä–∞–±–æ—Ç** ‚Äî —à–∞–±–ª–æ–Ω—ã (—á–∏—Å—Ç–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤, –¥–æ–∑–∞–ø—Ä–∞–≤–∫–∞)
- [ ] **–ú—É–ª—å—Ç–∏–º–∞—Å—Ç–µ—Ä** ‚Äî –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫ —Ä–∞–∑–Ω—ã–º –º–∞—Å—Ç–µ—Ä–∞–º
- [ ] **–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞** ‚Äî –≥—Ä–∞—Ñ–∏–∫–∏ –≤—ã—Ä—É—á–∫–∏ –ø–æ –Ω–µ–¥–µ–ª—è–º/–º–µ—Å—è—Ü–∞–º
- [ ] **Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** ‚Äî –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∑–∞—è–≤–∫–∞—Ö

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## üë• –ö–æ–Ω—Ç–∞–∫—Ç—ã

–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–ª—è CoolCare ‚Äî —Å–µ—Ä–≤–∏—Å –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä–æ–≤.
