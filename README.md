# CoolCare PWA

Progressive Web App для мастеров по ремонту и обслуживанию кондиционеров.

## Возможности

- **PWA** — установка на телефон, работа в оффлайне (Service Worker + IndexedDB)
- **SMS-аутентификация** — вход по номеру телефона (код пока в debug_code)
- **Заявки** — создание, редактирование, удаление, статусы (Назначена, В работе, Выполнена, Отменена)
- **Оффлайн-режим** — заявки можно создавать/редактировать локально. Автоматическая фоновая синхронизация с Supabase при возврате в сеть.
- **Календарь** — просмотр заявок по дням и неделям (с яркой подсветкой выходных/рабочих дней).
- **Карта** — Yandex Maps, геокодирование заявок.
- **Оптимизация маршрута** — порядок визитов по адресам (алгоритм nearest-neighbour)
- **Дашборд** — статистика заявок и выручки
- **Авто-деплой** — настроены GitHub Actions для обновления на VPS.

## Технологии

| Слой      | Стек              |
| --------- | ----------------- |
| Frontend  | React 18, Vite 5, React Router, IndexedDB |
| Backend   | FastAPI, Uvicorn (Логирование в `app.log`)  |
| БД        | Supabase (PostgreSQL) |
| Карты     | Yandex Maps API   |

## Установка

### Локальная разработка

```bash
# Backend
cd backend
python -m venv venv
venv\Scripts\activate   # Windows
pip install -r requirements.txt
cp .env.example .env    # настроить переменные
python main.py          ### Локальная разработка
1. Клонируйте репозиторий.
2. Настройте `.env` в папках `backend/` и `frontend/`.
3. Установите зависимости: `pip install -r backend/requirements.txt` и `npm install` в `frontend/` и `dispatcher/`.
4. Запустите: `npm run server` (бэкенд на порту 8000).

### Деплой на VPS (Ubuntu)
1. Используйте скрипт `deploy.sh`: `bash deploy.sh`.
2. Скрипт сам соберет фронтенд, обновит бэкенд и настроит Nginx как прокси.
3. Доступ будет осуществляться по порту 80:
   - Мастер PWA: `http://ваш-ip/`
   - Админ CRM: `http://ваш-ip/admin`

### Продакшен (сборка фронта)

```bash
cd frontend && npm install && npm run build
cd .. && python backend/main.py
```

FastAPI раздаёт статику из `frontend/dist`.

## Переменные окружения

### Backend (`backend/.env`)

| Переменная | Описание |
| ---------- | -------- |
| `SUPABASE_URL` | URL проекта Supabase |
| `SUPABASE_KEY` | Anon/Service ключ Supabase |
| `JWT_SECRET` | Секрет для JWT (обязательно сменить в продакшене) |

### Frontend (`frontend/.env`)

| Переменная | Описание |
| ---------- | -------- |
| `VITE_API_URL` | URL API (если не совпадает с origin) |
| `VITE_YANDEX_MAPS_API_KEY` | Ключ Yandex Maps API |

## Интеграция с GitHub Actions (Авто-деплой)

Добавьте следующие секреты (Repository Secrets) для авто-деплоя `main` ветки на ваш VPS:
- `VPS_HOST` — IP сервера
- `VPS_USER` — Имя пользователя SSH (e.g. `root`)
- `VPS_SSH_KEY` — Ваш приватный SSH ключ

## Планы на будущее (Улучшения)

- [ ] **Чат с клиентами или диспетчером** — WebSocket или встроенный модуль комментариев к заявке.
- [ ] **Фотоотчёты** — загрузка фотографий "до" и "после" (интеграция с Supabase Storage).
- [ ] **Уведомления в Telegram** — вместо SMS интегрировать телеграм-бота для оповещения мастеров/клиентов.
- [ ] **Экспорт отчетов** — возможность скачать PDF или Excel по завершенным заявкам.
- [ ] **Чек-листы** — шаблоны профилактических работ (чистка фильтров, дозаправка фреона и т.д.).
- [ ] **Мультимастер** — отдельное приложение для логики "диспетчер" -> назначение заявок разным мастерам.
- [ ] **Финансовая аналитика** — графики по выручке в разрезе недель/месяцев.

## Лицензия

MIT
